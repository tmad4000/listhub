{% extends "base.html" %}
{% block title %}Dashboard — ListHub{% endblock %}
{% block content %}
<div class="toolbar">
    <h1>Your Items</h1>
    <div style="display: flex; gap: 12px; align-items: center;">
        <form class="search-box" method="get" action="{{ url_for('views.dashboard') }}">
            <input type="text" name="q" placeholder="Search..." value="{{ q or '' }}">
            <input type="hidden" name="view" value="{{ view_mode }}">
        </form>
        <a href="{{ url_for('views.new_item') }}" class="btn btn-primary">New Item</a>
    </div>
</div>

<div style="display: flex; justify-content: space-between; align-items: center;">
    <div class="filter-tabs">
        <a href="{{ url_for('views.dashboard', view=view_mode) }}" class="filter-tab {% if not visibility_filter %}active{% endif %}">All</a>
        <a href="{{ url_for('views.dashboard', visibility='public', view=view_mode) }}" class="filter-tab {% if visibility_filter == 'public' %}active{% endif %}">Public</a>
        <a href="{{ url_for('views.dashboard', visibility='shared', view=view_mode) }}" class="filter-tab {% if visibility_filter == 'shared' %}active{% endif %}">Shared</a>
        <a href="{{ url_for('views.dashboard', visibility='private', view=view_mode) }}" class="filter-tab {% if visibility_filter == 'private' %}active{% endif %}">Private</a>
    </div>
    <div class="view-toggle">
        <a href="{{ url_for('views.dashboard', view='list', visibility=visibility_filter, q=q) }}" class="btn btn-sm {% if view_mode == 'list' %}btn-active{% endif %}" title="List view">List</a>
        <a href="{{ url_for('views.dashboard', view='folders', visibility=visibility_filter, q=q) }}" class="btn btn-sm {% if view_mode == 'folders' %}btn-active{% endif %}" title="Folder view">Folders</a>
    </div>
</div>

{% if items %}

{% if view_mode == 'folders' and folder_tree is not none %}
{# ── Tree view ── #}
{% set tree_owner = current_user.username %}
{% set tree_editable = true %}
{% include 'tree.html' %}
<script src="{{ url_for('static', filename='tree.js') }}"></script>

{% else %}
{# ── List view (default) ── #}
<div class="item-list">
    {% for item in items %}
    <div class="item-card">
        <div class="item-info">
            <a href="/@{{ current_user.username }}/{{ item.slug }}" class="item-title">{{ item.title or item.slug }}</a>
            <div class="item-meta">
                <span class="badge badge-{{ item.visibility }}" title="{{ item.visibility }}">
                    {% if item.visibility == 'public' %}&#127760;{% elif item.visibility == 'shared' %}&#128279;{% else %}&#128274;{% endif %}
                </span>
                <span class="badge badge-{{ item.item_type }}">{{ item.item_type }}</span>
                {% for tag in item.tags %}
                    <span class="tag">{{ tag }}</span>
                {% endfor %}
                <span>{{ item.updated_at[:16] if item.updated_at else '' }}</span>
                <span>rev {{ item.revision }}</span>
            </div>
        </div>
        <div class="item-actions">
            <a href="/@{{ current_user.username }}/{{ item.slug }}" class="btn btn-sm">View</a>
            <a href="{{ url_for('views.edit_item', item_id=item.id) }}" class="btn btn-sm">Edit</a>
            <form method="post" action="{{ url_for('views.delete_item', item_id=item.id) }}" style="display: inline;" onsubmit="return confirm('Delete this item?')">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-sm btn-danger">Delete</button>
            </form>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

{% else %}
<div class="empty-state">
    <p>No items yet. Create your first one!</p>
    <a href="{{ url_for('views.new_item') }}" class="btn btn-primary">New Item</a>
</div>
{% endif %}
{% endblock %}
